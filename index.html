<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ascension Lutheran Church & School | Fort Wayne, IN</title>
    <meta name="description" content="Welcome to Ascension Evangelical Lutheran Church in Fort Wayne, Indiana. We invite your family to join ours in worshipping and serving our glorious God. Founded 1977, LCMS.">
    <meta name="keywords" content="Lutheran Church, Fort Wayne, Indiana, LCMS, Christian School, Worship, Family Ministry, Preschool, Elementary School">
    <meta name="author" content="Ascension Lutheran Church & School">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Ascension Lutheran Church & School | Fort Wayne, IN">
    <meta property="og:description" content="Join our family in worshipping and serving our glorious God. Divine Worship at 8:00 AM & 10:45 AM every Sunday.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.alcsfw.org">
    <meta property="og:image" content="./images/Rose_ColorThumb.png">
    <meta property="og:site_name" content="Ascension Lutheran Church & School">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Ascension Lutheran Church & School">
    <meta name="twitter:description" content="Join our family in worshipping and serving our glorious God in Fort Wayne, Indiana.">
    <meta name="twitter:image" content="./images/Rose_ColorThumb.png">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#8B0000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Ascension Lutheran">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Ascension Lutheran">
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/png" href="./images/Rose_ColorThumb.png">
    <link rel="apple-touch-icon" href="./images/Rose_ColorThumb.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./images/Rose_ColorThumb.png">
    <link rel="apple-touch-icon" sizes="96x96" href="./images/Rose_ColorThumb.png">
    <link rel="apple-touch-icon" sizes="128x128" href="./images/Rose_ColorThumb.png">
    <link rel="apple-touch-icon" sizes="144x144" href="./images/Rose_ColorThumb.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./images/Rose_ColorThumb.png">
    <link rel="apple-touch-icon" sizes="192x192" href="./images/Rose_ColorThumb.png">
    <link rel="apple-touch-icon" sizes="384x384" href="./images/Rose_ColorThumb.png">
    <link rel="apple-touch-icon" sizes="512x512" href="./images/Rose_ColorThumb.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.youtube.com" crossorigin>
    <link rel="preconnect" href="https://www.facebook.com" crossorigin>
    
    <!-- DNS Prefetch -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="dns-prefetch" href="//www.youtube.com">
    <link rel="dns-prefetch" href="//www.facebook.com">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Files with cache busting -->
    <link rel="stylesheet" href="./css/main.css?v=2025-01-15-mobile-fix">
    <link rel="stylesheet" href="./css/components.css?v=2025-01-15">
    <link rel="stylesheet" href="./css/loading.css?v=2025-01-15">
    <link rel="stylesheet" href="./css/pwa.css?v=2025-01-15">
    
    <!-- Structured Data for Local Business -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Place",
      "@id": "https://www.alcsfw.org",
      "name": "Ascension Lutheran Church & School",
      "alternateName": "Ascension Lutheran",
      "description": "Evangelical Lutheran Church and School in Fort Wayne, Indiana. Member of the Lutheran Church Missouri Synod.",
      "url": "https://www.alcsfw.org",
      "telephone": "+1-260-486-2226",
      "faxNumber": "+1-260-486-5793",
      "email": "office@alcsfw.org",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "8811 St. Joe Road",
        "addressLocality": "Fort Wayne",
        "addressRegion": "IN",
        "postalCode": "46835",
        "addressCountry": "US"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": "41.0732",
        "longitude": "-85.0975"
      },
      "openingHours": [
        "Mo-Th 09:00-15:00",
        "Fr 09:00-12:00"
      ],
      "sameAs": [
        "https://www.facebook.com/alcsfw/",
        "https://www.youtube.com/c/alcsfw"
      ],
      "logo": "https://www.alcsfw.org/images/Rose_ColorThumb.png",
      "image": "https://www.alcsfw.org/images/Rose_ColorThumb.png",
      "foundingDate": "1977",
      "areaServed": {
        "@type": "City",
        "name": "Fort Wayne, IN"
      },
      "memberOf": {
        "@type": "Organization",
        "name": "Lutheran Church Missouri Synod",
        "url": "https://www.lcms.org"
      },
      "hasMap": "https://maps.google.com/?q=8811+St.+Joe+Road,+Fort+Wayne,+IN+46835"
    }
    </script>
    
    <!-- Religious Organization Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "ReligiousOrganization",
      "name": "Ascension Lutheran Church",
      "description": "Evangelical Lutheran Church serving Fort Wayne, Indiana since 1977. Member of the Lutheran Church Missouri Synod.",
      "url": "https://www.alcsfw.org",
      "logo": "https://www.alcsfw.org/images/Rose_ColorThumb.png",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "8811 St. Joe Road",
        "addressLocality": "Fort Wayne",
        "addressRegion": "IN",
        "postalCode": "46835",
        "addressCountry": "US"
      },
      "telephone": "+1-260-486-2226",
      "email": "office@alcsfw.org",
      "events": [
        {
          "@type": "Event",
          "name": "Sunday Divine Worship",
          "description": "Traditional Lutheran worship service with Holy Communion",
          "startTime": "08:00",
          "endTime": "09:00",
          "dayOfWeek": "Sunday",
          "location": {
            "@type": "Place",
            "name": "Ascension Lutheran Church",
            "address": {
              "@type": "PostalAddress",
              "streetAddress": "8811 St. Joe Road",
              "addressLocality": "Fort Wayne",
              "addressRegion": "IN",
              "postalCode": "46835"
            }
          }
        },
        {
          "@type": "Event",
          "name": "Sunday Divine Worship",
          "description": "Traditional Lutheran worship service with Holy Communion",
          "startTime": "10:45",
          "endTime": "11:45",
          "dayOfWeek": "Sunday",
          "location": {
            "@type": "Place",
            "name": "Ascension Lutheran Church",
            "address": {
              "@type": "PostalAddress",
              "streetAddress": "8811 St. Joe Road",
              "addressLocality": "Fort Wayne",
              "addressRegion": "IN",
              "postalCode": "46835"
            }
          }
        }
      ]
    }
    </script>
    
    <!-- School Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "School",
      "name": "Ascension Lutheran School",
      "description": "Christian education from Preschool through 8th grade with academic excellence within our Christ-centered Lutheran worldview.",
      "url": "https://www.alcsfw.org",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "8811 St. Joe Road",
        "addressLocality": "Fort Wayne",
        "addressRegion": "IN",
        "postalCode": "46835",
        "addressCountry": "US"
      },
      "telephone": "+1-260-486-2226",
      "email": "office@alcsfw.org",
      "founder": {
        "@type": "ReligiousOrganization",
        "name": "Ascension Lutheran Church"
      },
      "numberOfStudents": 94,
      "educationalLevel": ["Preschool", "Elementary School"],
      "hasCredential": "Lutheran Schools Accreditation"
    }
    </script>
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Beautiful Loading Screen -->
    <div id="loading-screen" class="loading-screen" role="status" aria-live="polite">
        <div class="loading-background">
            <div class="decorative-pattern">
                <div class="pattern-cross cross-1" aria-hidden="true">‚úö</div>
                <div class="pattern-cross cross-2" aria-hidden="true">‚úö</div>
                <div class="pattern-cross cross-3" aria-hidden="true">‚úö</div>
                <div class="pattern-cross cross-4" aria-hidden="true">‚úö</div>
                <div class="pattern-cross cross-5" aria-hidden="true">‚úö</div>
                <div class="pattern-cross cross-6" aria-hidden="true">‚úö</div>
                <div class="pattern-cross cross-7" aria-hidden="true">‚úö</div>
                <div class="pattern-cross cross-8" aria-hidden="true">‚úö</div>
                <div class="pattern-circle circle-1" aria-hidden="true"></div>
                <div class="pattern-circle circle-2" aria-hidden="true"></div>
                <div class="pattern-circle circle-3" aria-hidden="true"></div>
                <div class="pattern-circle circle-4" aria-hidden="true"></div>
                <div class="pattern-circle circle-5" aria-hidden="true"></div>
                <div class="pattern-circle circle-6" aria-hidden="true"></div>
                <div class="pattern-circle circle-7" aria-hidden="true"></div>
                <div class="pattern-circle circle-8" aria-hidden="true"></div>
            </div>
        </div>
        <div class="loading-content">
            <div class="church-logo">
                <img src="./images/Rose_ColorThumb.png" alt="Ascension Lutheran Church Luther Rose Logo" class="logo-img">
            </div>
            <h1 class="loading-title">Ascension Lutheran</h1>
            <p class="loading-subtitle">Church & School</p>
            <p class="loading-location">Fort Wayne, Indiana</p>
            <div class="loading-spinner">
                <div class="spinner"></div>
            </div>
            <p class="loading-status">Loading...</p>
            <div class="loading-verse">"I am the way, and the truth, and the life." - John 14:6</div>
        </div>
    </div>

    <!-- Navigation Header -->
    <header class="main-header" role="banner">
        <nav class="navbar" role="navigation" aria-label="Main navigation">
            <div class="nav-container">
                <div class="nav-brand-wrapper">
                    <div class="nav-logo-container" id="nav-logo-home" role="button" tabindex="0" aria-label="Go to home page">
                        <img src="./images/Rose_ColorThumb.png" alt="Ascension Lutheran Church Luther Rose Logo" class="nav-logo">
                    </div>
                    <div class="brand-text">
                        <h1 class="brand-name">Ascension Lutheran</h1>
                        <p class="brand-subtitle">Church & School</p>
                    </div>
                </div>
                
                <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="nav-menu">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                
                <div class="nav-menu" id="nav-menu" role="menubar">
                    <!-- Navigation will be populated by JavaScript -->
                </div>
            </div>
        </nav>
    </header>

    <!-- Page Content Container -->
    <main id="main-content" class="page-container" role="main">
        <div class="page-content">
            <section class="hero-section" role="banner">
                <div class="hero-content">
                    <h1 class="hero-title">Welcome to Ascension Lutheran Church</h1>
                    <p class="hero-subtitle">Church & School ‚Ä¢ Fort Wayne, Indiana</p>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="main-footer" id="main-footer" role="contentinfo">
        <!-- Footer will be populated by JavaScript -->
    </footer>

    <!-- Mobile PWA Install Prompt -->
    <div id="pwa-install-prompt" class="pwa-install-prompt hidden" role="dialog" aria-labelledby="pwa-title" aria-describedby="pwa-description">
        <div class="pwa-install-content">
            <div class="pwa-rose-icon">
                <img src="./images/Rose_ColorThumb.png" alt="Luther Rose" class="pwa-rose">
            </div>
            <div class="pwa-install-text">
                <h3 id="pwa-title">Install Ascension Lutheran</h3>
                <p id="pwa-description">Get quick access to worship times, announcements, and church info right from your home screen!</p>
            </div>
            <div class="pwa-install-buttons">
                <button id="pwa-install-btn" class="pwa-btn pwa-btn-primary">Install App</button>
                <button id="pwa-dismiss-btn" class="pwa-btn pwa-btn-secondary">Not Now</button>
            </div>
        </div>
    </div>

    <!-- Desktop PWA Install Banner -->
    <div id="desktop-install-banner" class="desktop-install-banner hidden" role="banner" aria-labelledby="banner-title" aria-describedby="banner-description">
        <div class="desktop-banner-content">
            <div class="banner-left">
                <img src="./images/Rose_ColorThumb.png" alt="Luther Rose" class="banner-logo">
                <div class="banner-text">
                    <h4 id="banner-title">Install Ascension Lutheran App</h4>
                    <p id="banner-description">Quick access to worship times and church information</p>
                </div>
            </div>
            <div class="banner-right">
                <button id="desktop-install-btn" class="banner-install-btn" aria-label="Install Ascension Lutheran App">
                    <span class="install-icon" aria-hidden="true">üì±</span>
                    Install App
                </button>
                <button id="desktop-dismiss-btn" class="banner-dismiss-btn" aria-label="Dismiss install banner">&times;</button>
            </div>
        </div>
    </div>

    <!-- ARIA Live Region for Announcements -->
    <div id="announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

    <!-- JavaScript Files with cache busting -->
    <script src="./content/content.js?v=2025-01-15"></script>
    <script src="./js/app.js?v=2025-01-15-mobile-fix"></script>
    
    <!-- MOBILE DEBUG & CACHE BUSTING SCRIPT -->
    <script>
        // Enhanced Mobile Debug Information
        console.log('üèõÔ∏è MOBILE DEBUG INFO:', {
            screenWidth: window.innerWidth,
            screenHeight: window.innerHeight,
            isMobile: window.innerWidth <= 767,
            devicePixelRatio: window.devicePixelRatio,
            userAgent: navigator.userAgent.substring(0, 100),
            timestamp: new Date().toISOString(),
            location: window.location.href
        });
        
        // Force mobile cache refresh
        if (window.innerWidth <= 767) {
            console.log('üèõÔ∏è Mobile device detected - forcing cache refresh');
            
            // Force service worker update
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    console.log('üèõÔ∏è Found', registrations.length, 'service workers');
                    registrations.forEach(registration => {
                        console.log('üèõÔ∏è Updating service worker');
                        registration.update();
                    });
                });
            }
            
            // Force reload if content not visible after 3 seconds
            setTimeout(() => {
                const pageContent = document.querySelector('.page-content');
                const mainContent = document.getElementById('main-content');
                
                console.log('üèõÔ∏è Mobile content check:', {
                    pageContentExists: !!pageContent,
                    pageContentChildren: pageContent ? pageContent.children.length : 0,
                    mainContentExists: !!mainContent,
                    mainContentVisible: mainContent ? mainContent.offsetHeight > 0 : false,
                    bodyHeight: document.body.offsetHeight
                });
                
                if (!pageContent || pageContent.children.length <= 1) {
                    console.log('üèõÔ∏è Mobile content not loaded properly, forcing refresh');
                    window.location.reload(true);
                }
            }, 3000);
        }
        
        // Performance monitoring
        if ('performance' in window) {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    const perfData = performance.getEntriesByType('navigation')[0];
                    console.log('üèõÔ∏è Page Load Performance:', {
                        loadTime: Math.round(perfData.loadEventEnd - perfData.loadEventStart),
                        domContentLoaded: Math.round(perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart),
                        firstPaint: performance.getEntriesByType('paint')[0]?.startTime || 'N/A'
                    });
                }, 0);
            });
        }
        
        // Extended loading manager
        let loadingTimer;
        
        function hideLoading() {
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                loadingScreen.classList.add('hidden');
                loadingScreen.setAttribute('aria-hidden', 'true');
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 800);
            }
        }
        
        // Extended loading time to appreciate the design and read the verse
        loadingTimer = setTimeout(hideLoading, 4500);
        
        window.addEventListener('load', () => {
            clearTimeout(loadingTimer);
            setTimeout(hideLoading, 3000);
        });
        
        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üèõÔ∏è DOM ready, initializing app...');
            
            // Announce to screen readers
            const announcements = document.getElementById('announcements');
            if (announcements) {
                announcements.textContent = 'Ascension Lutheran Church website loaded. Welcome!';
            }
        });
        
        // Register service worker with mobile-specific handling
        if ('serviceWorker' in navigator && (location.protocol === 'https:' || location.hostname === 'localhost')) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js?v=2025-01-15')
                    .then(registration => {
                        console.log('üèõÔ∏è Service Worker registered:', registration.scope);
                        
                        // Force update on mobile
                        if (window.innerWidth <= 767) {
                            registration.update();
                        }
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            console.log('üèõÔ∏è Service Worker update found');
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('üèõÔ∏è New content available, please refresh');
                                    // Could show update notification here
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('üèõÔ∏è Service Worker registration failed:', error);
                    });
            });
        }
        
        // Enhanced PWA Install Experience
        let deferredPrompt;
        let installPromptShown = false;
        
        console.log('üèõÔ∏è PWA Install: Starting setup...');
        
        // Force show install prompts for testing
        setTimeout(() => {
            console.log('üèõÔ∏è PWA Install: Showing test prompts...');
            forceShowInstallPromptsNow();
        }, 3000);
        
        function forceShowInstallPromptsNow() {
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                const mobilePrompt = document.getElementById('pwa-install-prompt');
                if (mobilePrompt) {
                    mobilePrompt.classList.remove('hidden');
                    mobilePrompt.setAttribute('aria-hidden', 'false');
                }
            } else {
                const desktopBanner = document.getElementById('desktop-install-banner');
                if (desktopBanner) {
                    desktopBanner.classList.remove('hidden');
                    desktopBanner.setAttribute('aria-hidden', 'false');
                    document.body.classList.add('banner-shown');
                }
            }
        }
        
        // Listen for the beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('üèõÔ∏è PWA install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            
            setTimeout(() => {
                if (!installPromptShown) {
                    showInstallPrompt();
                }
            }, 3000);
        });
        
        window.addEventListener('appinstalled', () => {
            console.log('üèõÔ∏è PWA was installed successfully!');
            hideAllInstallPrompts();
            deferredPrompt = null;
            
            // Announce to screen readers
            const announcements = document.getElementById('announcements');
            if (announcements) {
                announcements.textContent = 'Ascension Lutheran app has been installed successfully!';
            }
        });
        
        function showInstallPrompt() {
            if (installPromptShown) return;
            installPromptShown = true;
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                showMobileInstallPrompt();
            } else {
                showDesktopInstallBanner();
            }
        }
        
        function showMobileInstallPrompt() {
            const installPrompt = document.getElementById('pwa-install-prompt');
            if (installPrompt) {
                installPrompt.classList.remove('hidden');
                installPrompt.setAttribute('aria-hidden', 'false');
                
                // Focus management
                const installBtn = document.getElementById('pwa-install-btn');
                if (installBtn) {
                    installBtn.focus();
                }
            }
        }
        
        function showDesktopInstallBanner() {
            const installBanner = document.getElementById('desktop-install-banner');
            if (installBanner) {
                installBanner.classList.remove('hidden');
                installBanner.setAttribute('aria-hidden', 'false');
                document.body.classList.add('banner-shown');
            }
        }
        
        function hideInstallPrompt() {
            const installPrompt = document.getElementById('pwa-install-prompt');
            if (installPrompt) {
                installPrompt.classList.add('hidden');
                installPrompt.setAttribute('aria-hidden', 'true');
            }
        }
        
        function hideDesktopBanner() {
            const installBanner = document.getElementById('desktop-install-banner');
            if (installBanner) {
                installBanner.classList.add('hidden');
                installBanner.setAttribute('aria-hidden', 'true');
                document.body.classList.remove('banner-shown');
            }
        }
        
        function hideAllInstallPrompts() {
            hideInstallPrompt();
            hideDesktopBanner();
        }
        
        // Handle install button clicks
        document.addEventListener('click', (e) => {
            if (e.target.id === 'pwa-install-btn') {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        console.log('üèõÔ∏è User choice:', choiceResult.outcome);
                        deferredPrompt = null;
                        hideInstallPrompt();
                    });
                } else {
                    showInstallInstructions();
                }
            }
            
            else if (e.target.id === 'desktop-install-btn') {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        console.log('üèõÔ∏è User choice:', choiceResult.outcome);
                        deferredPrompt = null;
                        hideDesktopBanner();
                    });
                } else {
                    showInstallInstructions();
                }
            }
            
            else if (e.target.id === 'pwa-dismiss-btn') {
                hideInstallPrompt();
            } else if (e.target.id === 'desktop-dismiss-btn') {
                hideDesktopBanner();
            }
        });
        
        function showInstallInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isSafari = /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent);
            const isChrome = /Chrome/.test(navigator.userAgent);
            
            let instructions = '';
            
            if (isIOS && isSafari) {
                instructions = 'To install this app on your iOS device:\n\n1. Tap the Share button (‚ñ°‚Üó) in Safari\n2. Scroll down and tap "Add to Home Screen"\n3. Tap "Add" to confirm\n\nThe app will appear on your home screen!';
            } else if (isChrome) {
                instructions = 'To install this app:\n\n1. Click the three dots menu (‚ãÆ) in Chrome\n2. Select "Install Ascension Lutheran..."\n3. Click "Install" to confirm\n\nOr look for the install icon in the address bar!';
            } else {
                instructions = 'To install this app:\n\n1. Look for an install button in your browser\'s address bar\n2. Or check your browser\'s menu for "Install" or "Add to Home Screen" options\n3. Follow the prompts to install';
            }
            
            alert(instructions);
            hideAllInstallPrompts();
        }
        
        // Check if app is already running as PWA
        function isPWA() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true;
        }
        
        if (isPWA()) {
            console.log('üèõÔ∏è Running as installed PWA');
            document.body.classList.add('pwa-mode');
            
            // Add PWA indicator
            setTimeout(() => {
                const indicator = document.createElement('div');
                indicator.innerHTML = 'üì±';
                indicator.title = 'Running as installed app';
                indicator.setAttribute('aria-label', 'Running as installed app');
                indicator.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background: rgba(139, 0, 0, 0.9);
                    color: white;
                    padding: 0.5rem;
                    border-radius: 50%;
                    font-size: 1rem;
                    z-index: 10001;
                    opacity: 0.8;
                    cursor: pointer;
                    transition: opacity 0.3s ease;
                `;
                document.body.appendChild(indicator);
                
                setTimeout(() => {
                    indicator.style.opacity = '0';
                    setTimeout(() => indicator.remove(), 1000);
                }, 4000);
            }, 2000);
        }
        
        // Handle offline/online status
        window.addEventListener('online', () => {
            console.log('üèõÔ∏è Back online');
            document.body.classList.remove('offline-mode');
            
            const announcements = document.getElementById('announcements');
            if (announcements) {
                announcements.textContent = 'Connection restored. All features are now available.';
            }
        });
        
        window.addEventListener('offline', () => {
            console.log('üèõÔ∏è Gone offline');
            document.body.classList.add('offline-mode');
            
            const announcements = document.getElementById('announcements');
            if (announcements) {
                announcements.textContent = 'You are currently offline. Some features may not be available.';
            }
        });
        
        // Error handling
        window.addEventListener('error', (e) => {
            console.error('üèõÔ∏è JavaScript error:', e.error);
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            console.error('üèõÔ∏è Unhandled promise rejection:', e.reason);
        });
        
        // Keyboard navigation enhancements
        document.addEventListener('keydown', (e) => {
            // Escape key functionality
            if (e.key === 'Escape') {
                // Close any open modals or prompts
                if (!document.getElementById('pwa-install-prompt').classList.contains('hidden')) {
                    hideInstallPrompt();
                }
                if (!document.getElementById('desktop-install-banner').classList.contains('hidden')) {
                    hideDesktopBanner();
                }
            }
        });
        
        // Focus trap for PWA modals
        function trapFocus(element) {
            const focusableElements = element.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];
            
            element.addEventListener('keydown', (e) => {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstElement) {
                            lastElement.focus();
                            e.preventDefault();
                        }
                    } else {
                        if (document.activeElement === lastElement) {
                            firstElement.focus();
                            e.preventDefault();
                        }
                    }
                }
            });
        }
        
        // Apply focus trap to PWA install prompt
        const pwaPrompt = document.getElementById('pwa-install-prompt');
        if (pwaPrompt) {
            trapFocus(pwaPrompt);
        }
        
        console.log('üèõÔ∏è Ascension Lutheran Church PWA - Enhanced Mobile Fixed Version Loaded');
    </script>
</body>
</html>
